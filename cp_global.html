<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Connor Price Global Song Rankings - View community rankings for all Connor Price songs.">
  <meta name="robots" content="index,follow">
  <title>ðŸ”¥ Connor Price Global Rankings | RankSongs.com</title>

  <!-- Favicon (optional, but keeps consistency if present sitewide) -->
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <!-- Google Tag Manager (GTM-NGW77446) -->
  <script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NGW77446');
  </script>
  <!-- End Google Tag Manager -->

  <!-- Google AdSense (replace client ID with your actual ca-pub when ready) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0000000000000000" crossorigin="anonymous"></script>

  <!-- Advanced JSON-LD Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "@id": "https://ranksongs.com/#website",
        "url": "https://ranksongs.com/",
        "name": "RankSongs",
        "description": "Fan-powered interactive rankings of songs by your favorite artists.",
        "inLanguage": "en"
      },
      {
        "@type": "WebPage",
        "@id": "https://ranksongs.com/cp_global.html#webpage",
        "url": "https://ranksongs.com/cp_global.html",
        "name": "Connor Price Global Song Rankings",
        "description": "Community-powered Connor Price global leaderboard, including average rank, total points, and composite ranking for every Connor Price track.",
        "inLanguage": "en",
        "isPartOf": {
          "@id": "https://ranksongs.com/#website"
        },
        "breadcrumb": {
          "@id": "https://ranksongs.com/cp_global.html#breadcrumb"
        },
        "mainEntity": {
          "@id": "https://ranksongs.com/cp_global.html#itemlist"
        }
      },
      {
        "@type": "BreadcrumbList",
        "@id": "https://ranksongs.com/cp_global.html#breadcrumb",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://ranksongs.com/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Connor Price Global Rankings",
            "item": "https://ranksongs.com/cp_global.html"
          }
        ]
      },
      {
        "@type": "WebApplication",
        "@id": "https://ranksongs.com/cp_global.html#app",
        "name": "Connor Price Global Rankings Viewer",
        "applicationCategory": "EntertainmentApplication",
        "operatingSystem": "Any",
        "url": "https://ranksongs.com/cp_global.html",
        "description": "Interactive Connor Price ranking dashboard showing composite scores, average ranks, and fan vote metrics.",
        "inLanguage": "en"
      },
      {
        "@type": "ItemList",
        "@id": "https://ranksongs.com/cp_global.html#itemlist",
        "name": "Connor Price Songs Ranked Globally",
        "itemListOrder": "https://schema.org/ItemListOrderDescending",
        "numberOfItems": 42,
        "itemListElement": [
          { "@type": "ListItem", "position": 1, "item": { "@type": "MusicRecording", "name": "Down Bad", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 2, "item": { "@type": "MusicRecording", "name": "Stay The Course", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 3, "item": { "@type": "MusicRecording", "name": "Stick Up", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 4, "item": { "@type": "MusicRecording", "name": "Vibin", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 5, "item": { "@type": "MusicRecording", "name": "Young & Reckless", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 6, "item": { "@type": "MusicRecording", "name": "Violet", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 7, "item": { "@type": "MusicRecording", "name": "Out The Mud", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 8, "item": { "@type": "MusicRecording", "name": "Messed Up", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 9, "item": { "@type": "MusicRecording", "name": "Cameras Up", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 10, "item": { "@type": "MusicRecording", "name": "LIVE&LEARNRN", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 11, "item": { "@type": "MusicRecording", "name": "Underdog", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 12, "item": { "@type": "MusicRecording", "name": "Lost At Sea", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 13, "item": { "@type": "MusicRecording", "name": "My Life", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 14, "item": { "@type": "MusicRecording", "name": "Patio", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 15, "item": { "@type": "MusicRecording", "name": "Wasted", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 16, "item": { "@type": "MusicRecording", "name": "Days Like Today", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 17, "item": { "@type": "MusicRecording", "name": "SAFE", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 18, "item": { "@type": "MusicRecording", "name": "Lonely", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 19, "item": { "@type": "MusicRecording", "name": "Low Road", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 20, "item": { "@type": "MusicRecording", "name": "Always Sayin Sorry", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 21, "item": { "@type": "MusicRecording", "name": "Smile", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 22, "item": { "@type": "MusicRecording", "name": "Dead", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 23, "item": { "@type": "MusicRecording", "name": "Real Love", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 24, "item": { "@type": "MusicRecording", "name": "Plastic", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 25, "item": { "@type": "MusicRecording", "name": "Nothing Normal", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 26, "item": { "@type": "MusicRecording", "name": "Break", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 27, "item": { "@type": "MusicRecording", "name": "Faxcts", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 28, "item": { "@type": "MusicRecording", "name": "Coolin", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 29, "item": { "@type": "MusicRecording", "name": "So Good", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 30, "item": { "@type": "MusicRecording", "name": "My Way", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 31, "item": { "@type": "MusicRecording", "name": "Weekdays", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 32, "item": { "@type": "MusicRecording", "name": "Worth Fighting For", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 33, "item": { "@type": "MusicRecording", "name": "Breathe", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 34, "item": { "@type": "MusicRecording", "name": "Story", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 35, "item": { "@type": "MusicRecording", "name": "Old Me", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 36, "item": { "@type": "MusicRecording", "name": "Overtime", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 37, "item": { "@type": "MusicRecording", "name": "Bad News", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 38, "item": { "@type": "MusicRecording", "name": "Truth & Consequence", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 39, "item": { "@type": "MusicRecording", "name": "Can't Blame Me", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 40, "item": { "@type": "MusicRecording", "name": "No Confusion", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 41, "item": { "@type": "MusicRecording", "name": "CITY LIGHTS", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } },
          { "@type": "ListItem", "position": 42, "item": { "@type": "MusicRecording", "name": "Spin My Block", "byArtist": { "@type": "MusicGroup", "name": "Connor Price" } } }
        ]
      }
    ]
  }
  </script>

  <style>
    * {
      box-sizing: border-box;
    }
    
    html {
      background: #0f0f23 !important;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%) !important;
      min-height: 100vh;
      color: #ffffff !important;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 40% 80%, rgba(119, 221, 255, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    .back-home-btn {
      position: fixed; 
      top: 20px; 
      right: 20px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      padding: 12px 20px; 
      border-radius: 50px; 
      font-size: 14px;
      font-weight: 600;
      text-decoration: none; 
      display: flex; 
      align-items: center; 
      gap: 8px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease; 
      z-index: 1000;
    }

    .back-home-btn:hover { 
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    }

    .back-home-btn svg { 
      width: 16px; 
      height: 16px; 
      fill: white; 
      transition: transform 0.3s ease;
    }

    .back-home-btn:hover svg {
      transform: translateX(-2px);
    }

    .hero-heading {
      font-size: clamp(2.5rem, 6vw, 4rem);
      font-weight: 900;
      text-align: center;
      margin: 60px 0 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradientShift 6s ease infinite;
      letter-spacing: -0.02em;
      text-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .create-link {
      display: block;
      text-align: center;
      margin: 0 auto 40px auto;
      max-width: 300px;
      padding: 16px 32px;
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      text-decoration: none;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 50px;
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .create-link:hover {
      background: linear-gradient(135deg, #5a6fd8, #6a42a0);
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(102, 126, 234, 0.6);
    }

    .table-container {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      margin-bottom: 40px;
      overflow: hidden;
    }

    .table-title {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 25px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    #globalRankingsTable {
      width: 100%;
      border-collapse: collapse;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    #globalRankingsTable thead {
      background: rgba(102, 126, 234, 0.2);
    }

    #globalRankingsTable th {
      color: #fff;
      font-weight: 700;
      padding: 16px 12px;
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: background 0.3s ease;
      border: none;
      position: relative;
    }

    #globalRankingsTable th:hover {
      background: rgba(102, 126, 234, 0.3);
    }

    #globalRankingsTable td {
      color: rgba(255, 255, 255, 0.9);
      padding: 14px 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-weight: 500;
      text-align: center;
    }

    #globalRankingsTable tbody tr {
      transition: background 0.3s ease;
    }

    #globalRankingsTable tbody tr:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    /* Rank column highlighting */
    #globalRankingsTable td:first-child {
      font-weight: 700;
      color: #fff;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 8px;
      margin: 4px;
      width: 60px;
    }

    /* Song name column highlighting */
    #globalRankingsTable td:nth-child(2) {
      text-align: left;
      font-weight: 600;
      color: #fff;
    }

    /* Score highlighting */
    #globalRankingsTable td:last-child {
      font-weight: 700;
      color: #4facfe;
    }

    /* Responsive scrolling */
    .table-scroll {
      overflow-x: auto;
      border-radius: 16px;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }

      .hero-heading {
        margin: 40px 0 20px;
      }

      .table-container {
        padding: 20px 15px;
      }

      .back-home-btn {
        top: 10px;
        right: 10px;
        padding: 8px 12px;
        font-size: 12px;
      }

      #globalRankingsTable th,
      #globalRankingsTable td {
        padding: 10px 6px;
        font-size: 13px;
      }

      .table-title {
        font-size: 1.2rem;
      }
    }

    @media (max-width: 600px) {
      .table-container {
        padding: 15px 8px;
      }

      #globalRankingsTable th,
      #globalRankingsTable td {
        padding: 8px 4px;
        font-size: 12px;
      }

      #globalRankingsTable td:first-child {
        width: 40px;
      }
    }
  </style>
</head>
<body>

  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGW77446"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>
  <!-- End Google Tag Manager (noscript) -->

  <a href="index.html" class="back-home-btn" aria-label="Back to Home">
    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    Back to Home
  </a>

  <h1 class="hero-heading">Connor Price Global Rankings</h1>
  <a href="cp_ranks.html" class="create-link">Create My Connor Price Ranks</a>

  <div class="table-container">
    <div class="table-title">Community-Powered Connor Price Song Leaderboard</div>
    <div class="table-scroll">
      <table id="globalRankingsTable">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Song</th>
            <th>Avg Rank</th>
            <th># Times Ranked</th>
            <th>Total Points</th>
            <th>Composite Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
  const supabaseUrl = 'https://xtptcdopoitufrexwtng.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh0cHRjZG9wb2l0dWZyZXh3dG5nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NjE4ODUsImV4cCI6MjA2NjQzNzg4NX0.2LeRd-F4aKkObx5ylGxIVQGuDG3VO4lR8BlYshiBoh4';
  const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

  const PRIOR_COUNT = 25;
  const PRIOR_AVG = 10.5;
  let globalRankings = [];
  let currentSortColumn = 'weightedScore';
  let currentSortAsc = false;

  async function fetchGlobalRankings() {
    const { data, error } = await supabaseClient.from('cp_submissions').select();
    if (error) {
      alert('Error fetching global rankings: ' + error.message);
      return [];
    }

    // Full Connor Price song list
    const allSongs = [
      "Down Bad", "Stay The Course", "Stick Up", "Vibin", "Young & Reckless", 
      "Violet", "Out The Mud", "Messed Up", "Cameras Up", "LIVE&LEARNRN", 
      "Underdog", "Lost At Sea", "My Life", "Patio", "Wasted", "Days Like Today", 
      "SAFE", "Lonely", "Low Road", "Always Sayin Sorry", "Smile", "Dead",
      "Real Love", "Plastic", "Nothing Normal", "Break", "Faxcts", "Coolin", 
      "So Good", "My Way", "Weekdays", "Worth Fighting For", "Breathe", "Story", 
      "Old Me", "Overtime", "Bad News", "Truth & Consequence", "Can't Blame Me", 
      "No Confusion", "CITY LIGHTS", "Spin My Block"
    ];

    // Initialize stats for all songs
    const songStats = {};
    allSongs.forEach(song => {
      songStats[song] = { totalPoints: 0, timesRanked: 0, totalRankSum: 0, weightedRankings: 0, weightedCount: 0 };
    });

    const UNRANKED_WEIGHT = 0.5; // Weight for treating unranked songs as rank 21 (worst)
    const MIN_VOTES_FOR_LEADERBOARD = Math.max(1, Math.ceil(data.length * 0.05)); // 5% of total submissions, minimum 1

    data.forEach(submission => {
      const rankedSongs = new Set();
      
      // First pass: collect actual rankings
      for (let i = 1; i <= 20; i++) {
        const song = submission[`rank_${i}`];
        if (!song) continue;
        if (!songStats[song]) {
          songStats[song] = { totalPoints: 0, timesRanked: 0, totalRankSum: 0, weightedRankings: 0, weightedCount: 0 };
        }
        songStats[song].totalPoints += 21 - i;
        songStats[song].timesRanked++;
        songStats[song].totalRankSum += i;
        songStats[song].weightedRankings += i; // Full weight for actual rankings
        songStats[song].weightedCount += 1;
        rankedSongs.add(song);
      }
      
      // Second pass: add low-confidence negative signal for unranked songs
      allSongs.forEach(song => {
        if (!rankedSongs.has(song)) {
          songStats[song].weightedRankings += 21 * UNRANKED_WEIGHT;
          songStats[song].weightedCount += UNRANKED_WEIGHT;
        }
      });
    });

    const rankingsArray = Object.entries(songStats)
      .filter(([song, stats]) => stats.timesRanked >= MIN_VOTES_FOR_LEADERBOARD)
      .map(([song, stats]) => {
        const avgRank = stats.timesRanked > 0 ? stats.totalRankSum / stats.timesRanked : 21;
        const weightedAvgRank = stats.weightedCount > 0 ? stats.weightedRankings / stats.weightedCount : 21;
        const rawScore = ((PRIOR_COUNT * PRIOR_AVG) + (stats.weightedCount * weightedAvgRank)) / (PRIOR_COUNT + stats.weightedCount);
        const weightedScore = 21 - rawScore;
        const timesUnranked = Math.round((stats.weightedCount - stats.timesRanked) / UNRANKED_WEIGHT);

        return {
          song,
          totalPoints: stats.totalPoints,
          timesRanked: stats.timesRanked,
          avgRank,
          weightedScore,
          weightedCount: stats.weightedCount.toFixed(1),
          timesUnranked
        };
      });

    rankingsArray.sort((a, b) => b.weightedScore - a.weightedScore);
    rankingsArray.forEach((entry, idx) => {
      entry.rank = idx + 1;
    });

    globalRankings = rankingsArray;
    sortAndRenderTable();
  }

  function sortAndRenderTable() {
    let sorted = [...globalRankings];

    switch (currentSortColumn) {
      case 'rank':
        sorted.sort((a, b) => currentSortAsc ? a.rank - b.rank : b.rank - a.rank);
        break;
      case 'song':
        sorted.sort((a, b) => currentSortAsc ? a.song.localeCompare(b.song) : b.song.localeCompare(a.song));
        break;
      case 'avgRank':
        sorted.sort((a, b) => currentSortAsc ? a.avgRank - b.avgRank : b.avgRank - a.avgRank);
        break;
      case 'timesRanked':
        sorted.sort((a, b) => currentSortAsc ? a.timesRanked - b.timesRanked : b.timesRanked - a.timesRanked);
        break;
      case 'timesUnranked':
        sorted.sort((a, b) => currentSortAsc ? a.timesUnranked - b.timesUnranked : b.timesUnranked - a.timesUnranked);
        break;
      case 'totalPoints':
        sorted.sort((a, b) => currentSortAsc ? a.totalPoints - b.totalPoints : b.totalPoints - a.totalPoints);
        break;
      case 'weightedScore':
        sorted.sort((a, b) => currentSortAsc ? a.weightedScore - b.weightedScore : b.weightedScore - a.weightedScore);
        break;
    }

    const tbody = document.querySelector('#globalRankingsTable tbody');
    tbody.innerHTML = '';

    sorted.forEach(entry => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${entry.rank}</td>
        <td>${entry.song}</td>
        <td>${entry.avgRank.toFixed(2)}</td>
        <td>${entry.timesRanked}</td>
        <td>${entry.totalPoints}</td>
        <td>${entry.weightedScore.toFixed(2)}</td>
      `;
      tbody.appendChild(row);
    });
  }

  document.addEventListener('DOMContentLoaded', fetchGlobalRankings);

  document.querySelectorAll('#globalRankingsTable th').forEach((th, i) => {
    const keyMap = ['rank', 'song', 'avgRank', 'timesRanked', 'totalPoints', 'weightedScore'];
    th.addEventListener('click', () => {
      if (currentSortColumn === keyMap[i]) {
        currentSortAsc = !currentSortAsc;
      } else {
        currentSortColumn = keyMap[i];
        currentSortAsc = keyMap[i] === 'rank' ? true : false;
      }

      if (window.dataLayer) {
        window.dataLayer.push({
          event: 'cp_global_sort',
          column: currentSortColumn,
          ascending: currentSortAsc
        });
      }

      sortAndRenderTable();
    });
  });
  </script>
</body>
</html>

