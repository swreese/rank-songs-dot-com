<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Global NF song rankings based on fan votes. See which NF songs are ranked highest by the community." />
  <meta name="robots" content="index,follow" />
  <title>ðŸ”¥ NF Global Rankings | RankSongs.com</title>

  <style>
    * {
      box-sizing: border-box;
    }
    
    html {
      background: #0f0f23 !important;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%) !important;
      min-height: 100vh;
      color: #ffffff !important;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 40% 80%, rgba(119, 221, 255, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    .back-home-btn {
      position: fixed; 
      top: 20px; 
      right: 20px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      padding: 12px 20px; 
      border-radius: 50px; 
      font-size: 14px;
      font-weight: 600;
      text-decoration: none; 
      display: flex; 
      align-items: center; 
      gap: 8px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease; 
      z-index: 1000;
    }

    .back-home-btn:hover { 
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    }

    .back-home-btn svg { 
      width: 16px; 
      height: 16px; 
      fill: white; 
      transition: transform 0.3s ease;
    }

    .back-home-btn:hover svg {
      transform: translateX(-2px);
    }

    .hero-heading {
      font-size: clamp(2.5rem, 6vw, 4rem);
      font-weight: 900;
      text-align: center;
      margin: 60px 0 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradientShift 6s ease infinite;
      letter-spacing: -0.02em;
      text-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .create-link {
      display: block;
      text-align: center;
      margin: 0 auto 40px auto;
      max-width: 300px;
      padding: 16px 32px;
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      text-decoration: none;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 50px;
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .create-link:hover {
      background: linear-gradient(135deg, #5a6fd8, #6a42a0);
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(102, 126, 234, 0.6);
    }

    .table-container {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      margin-bottom: 40px;
      overflow: hidden;
    }

    .table-title {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 25px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    #globalRankingsTable {
      width: 100%;
      border-collapse: collapse;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    #globalRankingsTable thead {
      background: rgba(102, 126, 234, 0.2);
    }

    #globalRankingsTable th {
      color: #fff;
      font-weight: 700;
      padding: 16px 12px;
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: background 0.3s ease;
      border: none;
      position: relative;
    }

    #globalRankingsTable th:hover {
      background: rgba(102, 126, 234, 0.3);
    }

    #globalRankingsTable td {
      color: rgba(255, 255, 255, 0.9);
      padding: 14px 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-weight: 500;
      text-align: center;
    }

    #globalRankingsTable tbody tr {
      transition: background 0.3s ease;
    }

    #globalRankingsTable tbody tr:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    /* Rank column highlighting */
    #globalRankingsTable td:first-child {
      font-weight: 700;
      color: #fff;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 8px;
      margin: 4px;
      width: 60px;
    }

    /* Song name column highlighting */
    #globalRankingsTable td:nth-child(2) {
      text-align: left;
      font-weight: 600;
      color: #fff;
    }

    /* Score highlighting */
    #globalRankingsTable td:last-child {
      font-weight: 700;
      color: #4facfe;
    }

    /* Responsive scrolling */
    .table-scroll {
      overflow-x: auto;
      border-radius: 16px;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }

      .hero-heading {
        margin: 40px 0 20px;
      }

      .table-container {
        padding: 20px 15px;
      }

      .back-home-btn {
        top: 10px;
        right: 10px;
        padding: 8px 12px;
        font-size: 12px;
      }

      #globalRankingsTable th,
      #globalRankingsTable td {
        padding: 10px 6px;
        font-size: 13px;
      }

      .table-title {
        font-size: 1.2rem;
      }
    }

    @media (max-width: 600px) {
      .table-container {
        padding: 15px 8px;
      }

      #globalRankingsTable th,
      #globalRankingsTable td {
        padding: 8px 4px;
        font-size: 12px;
      }

      #globalRankingsTable td:first-child {
        width: 40px;
      }
    }
  </style>
</head>
<body>
<a href="index.html" class="back-home-btn" aria-label="Back to Home">
  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
    <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  Back to Home
</a>
<h1 class="hero-heading">NF Global Rankings</h1>
<a href="nf_ranks.html" class="create-link">Create My NF Ranks</a>
<div class="table-container">
  <table id="globalRankingsTable">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Song</th>
        <th>Avg Rank</th>
        <th># Times Ranked</th>
        <th>Total Points</th>
        <th>Composite Score</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const supabaseUrl = 'https://xtptcdopoitufrexwtng.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh0cHRjZG9wb2l0dWZyZXh3dG5nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NjE4ODUsImV4cCI6MjA2NjQzNzg4NX0.2LeRd-F4aKkObx5ylGxIVQGuDG3VO4lR8BlYshiBoh4';
const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
const PRIOR_COUNT = 25;
const PRIOR_AVG = 10.5;
let globalRankings = [];
let currentSortColumn = 'weightedScore';
let currentSortAsc = false;
async function fetchGlobalRankings() {
  const { data, error } = await supabaseClient.from('nf_submissions').select();
  if (error) {
    alert('Error fetching global rankings: ' + error.message);
    return [];
  }
  // Full NF song list
  const allSongs = [
    "Hands Up","Only One","Thing Called Love","Just Being Me","Intro","Mansion","All I Have","Wait","Wake Up","Face It","Motivated","Notepad","Turn The Music Up","Paralyzed","I'll Keep On",
    "Intro 2","Therapy Session","I Just Wanna Know","How Could You Leave Us","Breathe","Real","Oh Lord","I Can Feel It","Got You On My Mind","Grindin'","Wish You Wouldn't","Statement","All I Do","Lost In The Moment","Warm Up (Single)","Intro III","Outcast","10 Feet Down","Green Lights","Dreams","Let You Down","Destiny","My Life","You're Special","If You Want Love","Know","Remember This","Lie","3 A.M.","One Hundred","Options",
    "Time","The Search","Leave Me Alone","Change","My Stress","Nate","Returns","When I Grow Up","Only","Let Me Go","Hate Myself","I Miss The Days","No Excuses","Like This","Thinking","Trauma",
    "CLOUDS","THAT'S A JOKE","JUST LIKE YOU","STORY","PRIDEFUL","LOST","LAYERS","DRIFTING","TRUST","PAID MY DUES","HOPE","MOTTO","CAREFUL","MAMA","HAPPY","PANDEMONIUM","SUFFICE","GONE","TURN MY BACK","MISTAKE","LET EM PRAY","RUNNING","FEAR","HOME","WHO I WAS","GIVE ME A REASON","SORRY","WASHED UP"
  ];
  // Initialize stats for all songs
  const songStats = {};
  allSongs.forEach(song => {
    songStats[song] = { totalPoints: 0, timesRanked: 0, totalRankSum: 0, weightedRankings: 0, weightedCount: 0 };
  });

  const UNRANKED_WEIGHT = 0.5; // Weight for treating unranked songs as rank 0 (increased from 0.1)
  const MIN_VOTES_FOR_LEADERBOARD = Math.max(1, Math.ceil(data.length * 0.05)); // 5% of total submissions, minimum 1

  data.forEach(submission => {
    const rankedSongs = new Set();
    
    // First pass: collect actual rankings
    for (let i = 1; i <= 20; i++) {
      const song = submission[`rank_${i}`];
      if (!song) continue;
      if (!songStats[song]) songStats[song] = { totalPoints: 0, timesRanked: 0, totalRankSum: 0, weightedRankings: 0, weightedCount: 0 };
      songStats[song].totalPoints += 21 - i;
      songStats[song].timesRanked++;
      songStats[song].totalRankSum += i;
      songStats[song].weightedRankings += i; // Full weight for actual rankings
      songStats[song].weightedCount += 1;
      rankedSongs.add(song);
    }
    
    // Second pass: add low-confidence negative signal for unranked songs
    allSongs.forEach(song => {
      if (!rankedSongs.has(song)) {
        songStats[song].weightedRankings += 21 * UNRANKED_WEIGHT; // Rank 21 (worst) with low weight
        songStats[song].weightedCount += UNRANKED_WEIGHT;
      }
    });
  });

  const rankingsArray = Object.entries(songStats)
    .filter(([song, stats]) => stats.timesRanked >= MIN_VOTES_FOR_LEADERBOARD) // Filter by minimum votes
    .map(([song, stats]) => {
    const avgRank = stats.timesRanked > 0 ? stats.totalRankSum / stats.timesRanked : 21; // Default to worst rank if never ranked
    const weightedAvgRank = stats.weightedCount > 0 ? stats.weightedRankings / stats.weightedCount : 21;
    const rawScore = ((PRIOR_COUNT * PRIOR_AVG) + (stats.weightedCount * weightedAvgRank)) / (PRIOR_COUNT + stats.weightedCount);
    const weightedScore = 21 - rawScore;
    const timesUnranked = Math.round((stats.weightedCount - stats.timesRanked) / UNRANKED_WEIGHT); // Calculate times unranked
    return {
      song,
      totalPoints: stats.totalPoints,
      timesRanked: stats.timesRanked,
      avgRank,
      weightedScore,
      weightedCount: stats.weightedCount.toFixed(1),
      timesUnranked: timesUnranked
    };
  });
  rankingsArray.sort((a, b) => b.weightedScore - a.weightedScore);
  rankingsArray.forEach((entry, idx) => {
    entry.rank = idx + 1;
  });
  globalRankings = rankingsArray;
  sortAndRenderTable();
}
function sortAndRenderTable() {
  let sorted = [...globalRankings];
  switch (currentSortColumn) {
    case 'rank':
      sorted.sort((a, b) => currentSortAsc ? a.rank - b.rank : b.rank - a.rank);
      break;
    case 'song':
      sorted.sort((a, b) => currentSortAsc ? a.song.localeCompare(b.song) : b.song.localeCompare(a.song));
      break;
    case 'avgRank':
      sorted.sort((a, b) => currentSortAsc ? a.avgRank - b.avgRank : b.avgRank - a.avgRank);
      break;
    case 'timesRanked':
      sorted.sort((a, b) => currentSortAsc ? a.timesRanked - b.timesRanked : b.timesRanked - a.timesRanked);
      break;
    case 'timesUnranked':
      sorted.sort((a, b) => currentSortAsc ? a.timesUnranked - b.timesUnranked : b.timesUnranked - a.timesUnranked);
      break;
    case 'totalPoints':
      sorted.sort((a, b) => currentSortAsc ? a.totalPoints - b.totalPoints : b.totalPoints - a.totalPoints);
      break;
    case 'weightedScore':
      sorted.sort((a, b) => currentSortAsc ? a.weightedScore - b.weightedScore : b.weightedScore - a.weightedScore);
      break;
  }
  const tbody = document.querySelector('#globalRankingsTable tbody');
  tbody.innerHTML = '';
  sorted.forEach((entry) => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${entry.rank}</td>
      <td>${entry.song}</td>
      <td>${entry.avgRank.toFixed(2)}</td>
      <td>${entry.timesRanked}</td>
      <td>${entry.totalPoints}</td>
      <td>${entry.weightedScore.toFixed(2)}</td>
    `;
    tbody.appendChild(row);
  });
}
document.addEventListener('DOMContentLoaded', fetchGlobalRankings);
document.querySelectorAll('#globalRankingsTable th').forEach((th, i) => {
  const keyMap = ['rank', 'song', 'avgRank', 'timesRanked', 'totalPoints', 'weightedScore'];
  th.addEventListener('click', () => {
    if (currentSortColumn === keyMap[i]) {
      currentSortAsc = !currentSortAsc;
    } else {
      currentSortColumn = keyMap[i];
      currentSortAsc = keyMap[i] === 'rank' ? true : false;
    }
    sortAndRenderTable();
  });
});
</script>
</body>
</html>
