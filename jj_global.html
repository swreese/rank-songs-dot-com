<!DOCTYPE html>
<html lang="en">
<head>

  <!-- ============================================================
       IMPORTANT ANALYTICS & VERIFICATION SETUP â€” DO NOT ERASE
       ------------------------------------------------------------
       This site uses:
       â€¢ Google Search Console (site verification)
       â€¢ Google Tag Manager: GTM-NGW77446
       â€¢ Google Analytics (loaded through GTM)
       â€¢ Google AdSense (monetization)
       
       Removing any of the following tags will break:
       â€¢ Traffic tracking
       â€¢ Search indexing & ownership verification
       â€¢ Ad delivery
       ------------------------------------------------------------
       KEEP THESE BLOCKS INTACT.
       ============================================================ -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Search Console Verification -->
  <meta name="google-site-verification" content="jky8KPU5T5SdAvfQvD9jJtc0lVgI4A9zMPrl9F9CRFs" />

  <!-- Google Tag Manager -->
  <script>
    (function(w,d,s,l,i){
      w[l]=w[l]||[];
      w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
      var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
      j.async=true;
      j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
      f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NGW77446');
  </script>
  <!-- End Google Tag Manager -->

  <!-- Google AdSense -->
  <script async 
          src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2177244564929875"
          crossorigin="anonymous"></script>

  <!-- Meta Description & Title -->
  <meta name="description" content="Jack Johnson Global Song Rankings â€” community-powered live rankings of Jack Johnson songs based on fan submissions.">
  <title>ðŸ”¥ Jack Johnson Global Rankings | RankSongs.com</title>

  <!-- JSON-LD Schema: Organization, WebSite, WebPage, Breadcrumb, ItemList -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "Organization",
        "@id": "https://ranksongs.com/#organization",
        "name": "RankSongs",
        "url": "https://ranksongs.com/",
        "logo": "https://ranksongs.com/favicon.png"
      },
      {
        "@type": "WebSite",
        "@id": "https://ranksongs.com/#website",
        "url": "https://ranksongs.com/",
        "name": "RankSongs",
        "publisher": { "@id": "https://ranksongs.com/#organization" }
      },
      {
        "@type": "WebPage",
        "@id": "https://ranksongs.com/jj_global.html#webpage",
        "url": "https://ranksongs.com/jj_global.html",
        "name": "Jack Johnson Global Rankings",
        "description": "Live-updated global fan rankings of Jack Johnson songs.",
        "isPartOf": { "@id": "https://ranksongs.com/#website" },
        "about": {
          "@type": "MusicGroup",
          "name": "Jack Johnson"
        },
        "breadcrumb": { "@id": "https://ranksongs.com/#breadcrumb" }
      },
      {
        "@type": "BreadcrumbList",
        "@id": "https://ranksongs.com/#breadcrumb",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://ranksongs.com/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Jack Johnson Global Rankings",
            "item": "https://ranksongs.com/jj_global.html"
          }
        ]
      },
      {
        "@type": "ItemList",
        "@id": "https://ranksongs.com/jj_global.html#global-list",
        "name": "Jack Johnson Global Song Rankings",
        "itemListOrder": "http://schema.org/ItemListOrderAscending",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "item": {
              "@type": "MusicRecording",
              "name": "Better Together",
              "byArtist": {
                "@type": "MusicGroup",
                "name": "Jack Johnson"
              },
              "url": "https://ranksongs.com/jj_global.html#better-together"
            }
          },
          {
            "@type": "ListItem",
            "position": 2,
            "item": {
              "@type": "MusicRecording",
              "name": "Banana Pancakes",
              "byArtist": {
                "@type": "MusicGroup",
                "name": "Jack Johnson"
              },
              "url": "https://ranksongs.com/jj_global.html#banana-pancakes"
            }
          },
          {
            "@type": "ListItem",
            "position": 3,
            "item": {
              "@type": "MusicRecording",
              "name": "Sitting, Waiting, Wishing",
              "byArtist": {
                "@type": "MusicGroup",
                "name": "Jack Johnson"
              },
              "url": "https://ranksongs.com/jj_global.html#sitting-waiting-wishing"
            }
          },
          {
            "@type": "ListItem",
            "position": 4,
            "item": {
              "@type": "MusicRecording",
              "name": "Upside Down",
              "byArtist": {
                "@type": "MusicGroup",
                "name": "Jack Johnson"
              },
              "url": "https://ranksongs.com/jj_global.html#upside-down"
            }
          },
          {
            "@type": "ListItem",
            "position": 5,
            "item": {
              "@type": "MusicRecording",
              "name": "Flake",
              "byArtist": {
                "@type": "MusicGroup",
                "name": "Jack Johnson"
              },
              "url": "https://ranksongs.com/jj_global.html#flake"
            }
          },
          {
            "@type": "ListItem",
            "position": 6,
            "item": {
              "@type": "MusicRecording",
              "name": "Good People",
              "byArtist": {
                "@type": "MusicGroup",
                "name": "Jack Johnson"
              },
              "url": "https://ranksongs.com/jj_global.html#good-people"
            }
          },
          {
            "@type": "ListItem",
            "position": 7,
            "item": {
              "@type": "MusicRecording",
              "name": "Breakdown",
              "byArtist": {
                "@type": "MusicGroup",
                "name": "Jack Johnson"
              },
              "url": "https://ranksongs.com/jj_global.html#breakdown"
            }
          },
          {
            "@type": "ListItem",
            "position": 8,
            "item": {
              "@type": "MusicRecording",
              "name": "Taylor",
              "byArtist": {
                "@type": "MusicGroup",
                "name": "Jack Johnson"
              },
              "url": "https://ranksongs.com/jj_global.html#taylor"
            }
          },
          {
            "@type": "ListItem",
            "position": 9,
            "item": {
              "@type": "MusicRecording",
              "name": "Constellations",
              "byArtist": {
                "@type": "MusicGroup",
                "name": "Jack Johnson"
              },
              "url": "https://ranksongs.com/jj_global.html#constellations"
            }
          },
          {
            "@type": "ListItem",
            "position": 10,
            "item": {
              "@type": "MusicRecording",
              "name": "You and Your Heart",
              "byArtist": {
                "@type": "MusicGroup",
                "name": "Jack Johnson"
              },
              "url": "https://ranksongs.com/jj_global.html#you-and-your-heart"
            }
          }
        ]
      }
    ]
  }
  </script>

  <style>
    * {
      box-sizing: border-box;
    }
    
    html {
      background: #0f0f23 !important;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%) !important;
      min-height: 100vh;
      color: #ffffff !important;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 50%, rgba(120,119,198,0.1) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(255,119,198,0.1) 0%, transparent 50%),
                  radial-gradient(circle at 40% 80%, rgba(119,221,255,0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    h1, h2, p {
      color: #ffffff;
    }

    a {
      color: #9ecbff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    /* Back button style matching the index button */
    .back-home-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 18px;
      background: rgba(255, 255, 255, 0.08);
      color: #ffffff;
      border-radius: 999px;
      text-decoration: none;
      font-weight: 500;
      font-size: 14px;
      margin-top: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(15, 15, 35, 0.6);
      transition: all 0.3s ease;
    }

    .back-home-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    }

    .back-home-btn svg {
      width: 16px;
      height: 16px;
      fill: white;
      transition: transform 0.3s ease;
    }

    .back-home-btn:hover svg {
      transform: translateX(-2px);
    }

    .hero-heading {
      font-size: clamp(2.5rem, 6vw, 4rem);
      font-weight: 900;
      text-align: center;
      margin: 60px 0 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradientShift 6s ease infinite;
      letter-spacing: -0.02em;
      text-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    .create-link {
      display: block;
      text-align: center;
      color: #ffdd57;
      text-decoration: none;
      font-weight: bold;
      margin-bottom: 25px;
      font-size: 1.1rem;
    }

    .create-link:hover {
      text-decoration: underline;
    }

    .table-container {
      background: rgba(15, 15, 35, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      margin-bottom: 40px;
      overflow: hidden;
    }

    .table-title {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 25px;
    }

    .table-title span {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 4px 12px;
      border-radius: 999px;
      background: radial-gradient(circle at 0 50%, rgba(102, 126, 234, 0.5), transparent),
                  radial-gradient(circle at 100% 50%, rgba(248, 113, 113, 0.5), transparent);
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.85);
    }

    .table-title span::before {
      content: 'â˜…';
      color: #ffdd57;
    }

    .table-subtitle {
      text-align: center;
      font-size: 0.95rem;
      color: rgba(226, 232, 240, 0.8);
      margin-bottom: 20px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    .key-chip-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .key-chip {
      font-size: 0.8rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: rgba(226, 232, 240, 0.9);
      background: rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .key-chip span.icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #facc15, transparent),
                  radial-gradient(circle at 70% 70%, #fb7185, transparent);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .key-chip strong {
      color: #e5e7eb;
    }

    .sort-hint {
      text-align: center;
      font-size: 0.8rem;
      color: rgba(148, 163, 184, 0.9);
      margin-bottom: 15px;
    }

    .scroll-hint {
      font-size: 0.8rem;
      color: rgba(148, 163, 184, 0.9);
      text-align: right;
      margin-bottom: 5px;
    }

    .table-wrapper {
      border-radius: 18px;
      overflow: auto;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.1), transparent),
                  radial-gradient(circle at 100% 100%, rgba(244, 114, 182, 0.1), transparent),
                  rgba(15, 23, 42, 0.95);
    }

    #globalRankingsTable {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
      min-width: 650px;
    }

    #globalRankingsTable th,
    #globalRankingsTable td {
      padding: 12px 14px;
      text-align: center;
      white-space: nowrap;
    }

    #globalRankingsTable th {
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-weight: 600;
      border-bottom: 1px solid rgba(148, 163, 184, 0.5);
      position: sticky;
      top: 0;
      z-index: 10;
      cursor: pointer;
      user-select: none;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    #globalRankingsTable th:hover {
      background: rgba(30, 64, 175, 0.8);
    }

    #globalRankingsTable td {
      border-bottom: 1px solid rgba(55, 65, 81, 0.7);
      color: #e5e7eb;
    }

    #globalRankingsTable tbody tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.9);
    }

    #globalRankingsTable tbody tr:nth-child(odd) {
      background: rgba(17, 24, 39, 0.95);
    }

    #globalRankingsTable tbody tr {
      transition: background 0.3s ease;
    }

    #globalRankingsTable tbody tr:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    /* Rank column highlighting */
    #globalRankingsTable td:first-child {
      font-weight: 700;
      color: #fff;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 8px;
      margin: 4px;
      width: 60px;
    }

    /* Song name column highlighting */
    #globalRankingsTable td:nth-child(2) {
      text-align: left;
      font-weight: 600;
      color: #fff;
    }

    /* Score highlighting */
    #globalRankingsTable td:last-child {
      font-weight: 700;
      color: #4facfe;
    }

    /* Responsive scrolling */
    @media (max-width: 768px) {
      .table-container {
        padding: 20px;
      }

      .scroll-hint {
        text-align: left;
        margin-bottom: 10px;
      }

      #globalRankingsTable {
        font-size: 0.85rem;
      }

      #globalRankingsTable th,
      #globalRankingsTable td {
        padding: 10px 12px;
      }
    }

    /* Sort indicator arrows */
    .sort-indicator {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-left: 4px;
    }

    .hero-heading {
      margin-top: 40px;
    }
  </style>

</head>
<body>

  <!-- Google Tag Manager (noscript) â€” DO NOT REMOVE -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NGW77446"
            height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>
  <!-- End Google Tag Manager (noscript) -->

<a href="index.html" class="back-home-btn" aria-label="Back to Home">
  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
    <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
  Back to Home
</a>

<h1 class="hero-heading">Jack Johnson Global Rankings</h1>
<a href="jj_ranks.html" class="create-link">Create My Jack Johnson Ranks</a>

<div class="table-container">
  <div class="table-title">
    <span>Live Community Rankings</span><br />
    Global Jack Johnson Song Leaderboard
  </div>
  <p class="table-subtitle">
    These rankings are calculated from all submitted Jack Johnson song lists. Scores are weighted to reward songs that are ranked highly and consistently while still accounting for less common deep cuts.
  </p>

  <div class="key-chip-row">
    <div class="key-chip">
      <span class="icon">Î£</span>
      <strong>Total Points</strong> â€” Higher scores mean more love across all lists.
    </div>
    <div class="key-chip">
      <span class="icon">â˜…</span>
      <strong>Avg Rank</strong> â€” Average placement when the song appears in lists.
    </div>
    <div class="key-chip">
      <span class="icon">âˆž</span>
      <strong>Composite Score</strong> â€” Our weighted metric balancing popularity and consistency.
    </div>
  </div>

  <p class="sort-hint">Tap column headers to sort by Rank, Song, Avg Rank, Times Ranked, Total Points, or Composite Score.</p>
  <p class="scroll-hint">ðŸ“± On mobile? Scroll sideways to view the full table.</p>

  <div class="table-wrapper">
    <table id="globalRankingsTable">
      <thead>
        <tr>
          <th>Rank <span class="sort-indicator" id="rankSortIndicator"></span></th>
          <th>Song <span class="sort-indicator" id="songSortIndicator"></span></th>
          <th>Avg Rank <span class="sort-indicator" id="avgRankSortIndicator"></span></th>
          <th># Times Ranked <span class="sort-indicator" id="timesRankedSortIndicator"></span></th>
          <th>Total Points <span class="sort-indicator" id="totalPointsSortIndicator"></span></th>
          <th>Composite Score <span class="sort-indicator" id="weightedScoreSortIndicator"></span></th>
        </tr>
      </thead>
      <tbody>
        <!-- Global rankings will be populated here -->
      </tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const { createClient } = supabase;
const supabaseUrl = 'https://clcgnisjmfbpkmozjlfv.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsY2duaXNqbWZicGttb3pqbGZ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDEyMzYyNjAsImV4cCI6MjAxNjgxMjI2MH0.D496pvDW-xS9j62Px8o_g4-yz0b5xf2tFBsJ4CgbbK0';
const supabaseClient = createClient(supabaseUrl, supabaseKey);

// Prior parameters
const PRIOR_COUNT = 10; // Adjust this value to change the weight of the prior
const PRIOR_AVG = 11; // Prior average rank corresponding to the song being in the middle of a 1-20 scale

// New parameter for unranked songs
const UNRANKED_WEIGHT = 0.1; // Adjust this value to weight unranked songs

// Fetch global rankings from the 'jj_submissions' table and display them
async function fetchGlobalRankings() {
  const { data, error } = await supabaseClient
    .from('jj_submissions')
    .select();

  if (error) {
    alert('Error fetching global rankings: ' + error.message);
    return;
  }

  // Full Jack Johnson song list
  const allSongs = [
    "Inaudible Melodies", "Middle Man", "Posters", "Sexy Plexi", "Flake", "Bubble Toes",
    "Fortunate Fool", "The News", "Drink The Water", "Mudfootball", "F-Stop Blues", "Losing Hope",
    "It's All Understood", "Flake (Live)", "Inaudible Melodies (Live)", "Posters (Live)", "Sexy Plexi (Live)",
    "Middle Man (Live)", "Mudfootball (Live)", "Angel", "Better Together", "Never Know", "Banana Pancakes",
    "Good People", "No Other Way", "Sitting, Waiting, Wishing", "Staple It Together", "Situations",
    "Crying Shame", "If I Could", "Breakdown", "Belle", "Do You Remember", "Constellations",
    "Upside Down", "Talk of the Town", "Fall Line (Live)", "Taylor (Live)", "Hole to Fill (Live)",
    "The Horizon Has Been Defeated (Live)", "Good People (Jack Johnson & Friends Version)", "Traffic in the Sky (Live)",
    "Better Together (Live from the Solar Powered Plastic Plant)", "Staple It Together (Live from the Solar Powered Plastic Plant)",
    "Never Know (Live from the Solar Powered Plastic Plant)", "Sitting, Waiting, Wishing (Live from the Solar Powered Plastic Plant)",
    "Constellations (Live from the Solar Powered Plastic Plant)", "What You Thought You Need",
    "Adrift", "Sleep Through the Static", "Hope", "Enemy", "If I Had Eyes", "All at Once",
    "Go On", "They Do, They Don't", "Monsoon", "Losing Keys", "Angel (Live from the Greek Theatre, Los Angeles)",
    "If I Had Eyes (Live from the Greek Theatre, Los Angeles)", "Sleep Through the Static (Live from the Greek Theatre, Los Angeles)",
    "Hope (Live from the Greek Theatre, Los Angeles)", "Enemy (Live from the Greek Theatre, Los Angeles)",
    "Go On (Live from the Greek Theatre, Los Angeles)", "All at Once (Live from the Greek Theatre, Los Angeles)",
    "Only the Ocean", "You and Your Heart", "To the Sea", "No Good with Faces", "At or With Me",
    "When I Look Up", "From the Clouds", "Turn Your Love", "The Upsetter", "Red Wine, Mistakes, Mythology",
    "Pictures of People Taking Pictures", "Anything but the Truth", "Only the Ocean (Acoustic)",
    "Washing Dishes", "I Got You", "Shot Reverse Shot", "Never Fade", "Tape Deck", "Don't Believe a Thing I Say",
    "As I Was Saying", "You Remind Me of You", "Radiate", "Ones and Zeros", "Change", "Home",
    "Fragments", "Losing Keys (Live from Yokohama)", "Good People (Live from Yokohama)",
    "No Other Way (Live from Yokohama)", "In the Morning", "Imagine", "Sunsets for Somebody Else",
    "My Mind Is for Sale", "Daybreaks", "Big Sur", "Love Song #16", "Is One Moon Enough?",
    "Gather", "You Can't Control It", "Big Sur (Acoustic)", "My Mind Is for Sale (Acoustic)",
    "Don't Let Me Down", "Upside Down (Live Acoustic)", "Angel (Acoustic)", "Imagine (Live Acoustic)",
    "The Captain Is Drunk", "If Ever", "Don't Let Me Down (Acoustic)"
  ];

  // Initialize song stats
  const songStats = {};
  allSongs.forEach(song => {
    songStats[song] = {
      totalPoints: 0,
      timesRanked: 0,
      weightedRankings: 0,
      weightedCount: 0 // To track the weighted count
    };
  });

  // Process each submission to aggregate rankings
  data.forEach(entry => {
    const rankedSongs = entry.songs || []; 
    rankedSongs.forEach((song, position) => {
      if (!songStats[song]) {
        songStats[song] = {
          totalPoints: 0,
          timesRanked: 0,
          weightedRankings: 0,
          weightedCount: 0
        };
      }

      // Points: reverse of rank (20 for rank 1, 1 for rank 20)
      const points = 21 - (position + 1);
      songStats[song].totalPoints += points;
      songStats[song].timesRanked += 1;

      const positionWeight = 1 + (position + 1) * UNRANKED_WEIGHT; 
      songStats[song].weightedRankings += (position + 1) * positionWeight;
      songStats[song].weightedCount += positionWeight;
    });
  });

  const rankingsArray = Object.entries(songStats).map(([song, stats]) => {
    const avgRank = stats.timesRanked > 0 ? stats.weightedRankings / stats.weightedCount : PRIOR_AVG;
    const weightedAvgRank = stats.weightedCount > 0 ? stats.weightedRankings / stats.weightedCount : PRIOR_AVG;

    const rawScore = ((PRIOR_COUNT * PRIOR_AVG) + (stats.weightedCount * weightedAvgRank)) / (PRIOR_COUNT + stats.weightedCount);
    const weightedScore = 21 - rawScore;

    const timesUnranked = Math.round((stats.weightedCount - stats.timesRanked) / UNRANKED_WEIGHT);

    return {
      song,
      totalPoints: stats.totalPoints,
      timesRanked: stats.timesRanked,
      avgRank,
      weightedScore,
      weightedCount: stats.weightedCount.toFixed(1),
      timesUnranked: timesUnranked
    };
  });

  rankingsArray.sort((a, b) => b.weightedScore - a.weightedScore);

  rankingsArray.forEach((entry, idx) => {
    entry.rank = idx + 1;
  });

  return rankingsArray;
}

// Utility function to round to one decimal place
function formatNumber(num) {
  return Math.round(num * 10) / 10;
}

let globalRankings = [];
let currentSortColumn = 'weightedScore';
let currentSortAsc = false;

function renderGlobalRankingsTable() {
  const tbody = document.querySelector('#globalRankingsTable tbody');
  tbody.innerHTML = '';

  globalRankings.forEach((entry) => {
    const row = document.createElement('tr');

    const rankCell = document.createElement('td');
    rankCell.textContent = entry.rank;
    row.appendChild(rankCell);

    const songCell = document.createElement('td');
    songCell.textContent = entry.song;
    row.appendChild(songCell);

    const avgRankCell = document.createElement('td');
    avgRankCell.textContent = formatNumber(entry.avgRank);
    row.appendChild(avgRankCell);

    const timesRankedCell = document.createElement('td');
    timesRankedCell.textContent = entry.timesRanked;
    row.appendChild(timesRankedCell);

    const totalPointsCell = document.createElement('td');
    totalPointsCell.textContent = entry.totalPoints;
    row.appendChild(totalPointsCell);

    const weightedScoreCell = document.createElement('td');
    weightedScoreCell.textContent = formatNumber(entry.weightedScore);
    row.appendChild(weightedScoreCell);

    tbody.appendChild(row);
  });
}

function sortAndRenderTable() {
  const sortOrder = currentSortAsc ? 1 : -1;

  globalRankings.sort((a, b) => {
    if (a[currentSortColumn] < b[currentSortColumn]) return -1 * sortOrder;
    if (a[currentSortColumn] > b[currentSortColumn]) return 1 * sortOrder;
    return 0;
  });

  const rankSortIndicator = document.getElementById('rankSortIndicator');
  const songSortIndicator = document.getElementById('songSortIndicator');
  const avgRankSortIndicator = document.getElementById('avgRankSortIndicator');
  const timesRankedSortIndicator = document.getElementById('timesRankedSortIndicator');
  const totalPointsSortIndicator = document.getElementById('totalPointsSortIndicator');
  const weightedScoreSortIndicator = document.getElementById('weightedScoreSortIndicator');

  rankSortIndicator.textContent = '';
  songSortIndicator.textContent = '';
  avgRankSortIndicator.textContent = '';
  timesRankedSortIndicator.textContent = '';
  totalPointsSortIndicator.textContent = '';
  weightedScoreSortIndicator.textContent = '';

  const arrow = currentSortAsc ? 'â–²' : 'â–¼';

  if (currentSortColumn === 'rank') {
    rankSortIndicator.textContent = arrow;
  } else if (currentSortColumn === 'song') {
    songSortIndicator.textContent = arrow;
  } else if (currentSortColumn === 'avgRank') {
    avgRankSortIndicator.textContent = arrow;
  } else if (currentSortColumn === 'timesRanked') {
    timesRankedSortIndicator.textContent = arrow;
  } else if (currentSortColumn === 'totalPoints') {
    totalPointsSortIndicator.textContent = arrow;
  } else if (currentSortColumn === 'weightedScore') {
    weightedScoreSortIndicator.textContent = arrow;
  }

  renderGlobalRankingsTable();
}

document.addEventListener('DOMContentLoaded', async () => {
  globalRankings = await fetchGlobalRankings();
  sortAndRenderTable();

  document.querySelectorAll('#globalRankingsTable th').forEach((th, i) => {
    const keyMap = ['rank', 'song', 'avgRank', 'timesRanked', 'totalPoints', 'weightedScore'];
    th.addEventListener('click', () => {
      if (currentSortColumn === keyMap[i]) {
        currentSortAsc = !currentSortAsc;
      } else {
        currentSortColumn = keyMap[i];
        currentSortAsc = keyMap[i] === 'rank' ? true : false;
      }
      sortAndRenderTable();
    });
  });
});
</script>

  <footer style="text-align:center; padding:20px; margin-top:40px; font-size:13px; color:rgba(255,255,255,0.6);">
    <a href="https://www.keybuzzdigital.com"
       target="_blank"
       rel="noopener"
       style="color:#9ecbff; text-decoration:none;">
       Website by KeyBuzz Digital
    </a>
  </footer>

</body>
</html>
